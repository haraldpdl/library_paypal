<h1>PayPal Express Checkout<br /><small>v2.0 for osCommerce Online Merchant v2.3</small></h1>

<p>PayPal Express Checkout is bundled with osCommerce Online Merchant and is also available as a separate Add-On package existing store owners can use to upgrade to.</p>

<p>PayPal Express Checkout is automatically pre-configured for new osCommerce Online Merchant installations where payments are sent to the configured store owner e-mail address. This allows store owners to start accepting payments immediately and to complete their PayPal merchant account when their first payments have arrived.</p>

<p>The PayPal Express Checkout payment module supports the following features:</p>

<ul>
  <li>Seamless Checkout: Customers who Log In with PayPal do not need to log in again for Express Checkout</li>
  <li>Instant Update: Dynamic shipping rates are retrieved from Express Checkout</li>
  <li>PayPal Account Optional: Customers do not need a local store or PayPal account and can proceed through Express Checkout as a guest</li>
  <li>Authorization and Sale transaction methods</li>
  <li>SSL Certificate verified transactions</li>
  <li>Sandbox server to perform test transactions</li>
</ul>

<h3>Customer Accounts</h3>

<p>PayPal Express Checkout allows guest purchases to be made without the customer needing to create or log into their local store account. A local customer account is however created when they return back to the store from the Express Checkout flow to keep track of the order.</p>

<p>If the Set Password account content module is not installed, the automatically created account is assigned a randomly generated password which is e-mailed to the customers e-mail address PayPal provides.</p>

<p>If the Set Password account content module is installed, the password is left empty and no e-mail is sent to the customer. The customer then has the opportunity to set their own password in the My Account page during their session or they will only able to log in again through Log In with PayPal or PayPal Express Checkout when their next order is made.</p>

<h3>Order Processing</h3>

<p>The PayPal Express Checkout payment module has been developed to finalize the order transaction during the Express Checkout flow. The order is confirmed during the Express Checkout flow when the customer uses the "Pay Now" button to finalize the order. On returning back to the store, a check on the transaction total is performed - if it matches the order total the customer is directed to the checkout success page otherwise, on rare occassions, they are directed to the checkout confirmation page where they must confirm their order again.</p>

<p>The PayPal transaction total may differ from the order total in the following scenarios:</p>

<ul>
  <li>when Instant Update is not enabled and the customer chooses another shipping address which shipping rates and taxes may be applied to or removed from the order</li>
  <li>when third-party Order Total modules are installed that manipulate taxes applied to the order</li>
  <li>when digital downloads are purchased and the customer chooses another billing address which taxes may be applied to or removed from the order</li>
</ul>

<p>In the rare occassion where the PayPal transaction total does not match the order total, the customer has the opportunity to review their order and order total calculations (including taxes) before confirming and processing the order on the checkout confirmation page.</p>

<h3>Line Items</h3>

<p>Each product that is ordered is passed on to PayPal as line items to show to the customer during the Express Checkout flow. This includes extra third-party Order Total modules that manipulate the order total values (eg, discounts). In rare occassions, when the line items, shipping, and tax calculations do not match the order total value, only the order total value is passed onto PayPal without the line items.</p>

<h2>Features</h2>

<h3>Seamless Checkout</h3>

<p>Seamless Checkout requires the separate <a href="{link}Package|Library|en&paypal&oscom23&log_in_with_paypal{link}" target="_blank">Log In with PayPal</a> content module and allows customers who have logged in through PayPal to proceed straight to the Express Checkout flow without needing to log in again.</p>

<p>The Log In with PayPal content module is bundled with osCommerce Online Merchant (since v2.3.4) and is also available as a separate Add-On package at:</p>

<p><a href="http://addons.oscommerce.com/info/xxx" target="_blank">http://addons.oscommerce.com/info/xxx</a></p>

<h3>Instant Update</h3>

<p>As soon as the customer has logged in at PayPal or has provided their shipping address during the Express Checkout flow, PayPal contacts your online store to retrieve a list of applicable shipping rates and taxes for the shipping destination. The customer is able to choose their preferred shipping rate which is passed back to the store to use for the order.</p>

<p>As of osCommerce Online Merchant v2.3.4, orders can be blocked when no shipping rate for the destination is available. If this is enabled and Instant Update detects that no shipping rates are available, it requests the customer to select or enter a new shipping address during the Express Checkout flow and prevents them to continue with the order until a valid shipping destination has been selected.</p>

<h4>Requirements</h4>

<p>Instant Update requires the following for the shipping rates to be retrieved:</p>

<ul>
  <li>Your store installation must be configured for and have SSL enabled.</li>
</ul>

<h3>PayPal Account Optional</h3>

<p>PayPal Account Optional allows customers without a local or PayPal account to proceed through the Express Checkout flow as a guest. Customers do not need to create a PayPal account during the Express Checkout flow and their shipping and billing information is passed back to the store to use for the order.</p>

<h3>SSL Certificate Verified Transactions</h3>

<p>All secured API transaction calls sent to PayPal are performed by verifying PayPal's SSL certificates to guarantee the identity of PayPal. This is performed by using the following public keys in order if they are available:</p>

<ul>
  <li>ext/modules/payment/paypal/paypal.com.crt</li>
  <li>includes/cacert.pem (public key bundle)</li>
  <li>the web server configured public key bundle</li>
</ul>

<p>A test connection link is available on the payment module configuration page which can be used to test if API transaction calls to PayPal can be verified from your web server. If the test connection fails, please contact your hosting provider as they may need to update your web server configuration. The SSL certificate verification can also be disabled on the payment module configuration page however it is highly discouraged to disable.</p>

<div class="alert">Some web hosting providers require a curl proxy to be used which can be configured on the payment module configuration page.</div>

<h2>Configuration Settings</h2>

<table class="table table-striped table-hover">
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Enable PayPal Express Checkout</td>
      <td>Setting this parameter to <em>True</em> makes the payment method available to customers during the checkout procedure. A "Check Out with PayPal" image button is also shown on the shopping cart page.</td>
      <td><em>True</em></td>
    </tr>
    <tr>
      <td>Seller Account</td>
      <td>The PayPal e-mail address of the seller/merchant account. This is automatically set to the configured store owner e-mail address for new installations. This field is not required if API credentials are used.</td>
      <td></td>
    </tr>
    <tr>
      <td>API Username</td>
      <td>The username to use for the PayPal API service. This is tied to your PayPal seller e-mail address profile to accept payments for.</td>
      <td></td>
    </tr>
    <tr>
      <td>API Password</td>
      <td>The password to use for the PayPal API service.</td>
      <td></td>
    </tr>
    <tr>
      <td>API Signature</td>
      <td>The signature to use for the PayPal API service.</td>
      <td></td>
    </tr>
    <tr>
      <td>PayPal Account Optional</td>
      <td>Allow guests to continue through the Express Checkout flow without logging in through PayPal.</td>
      <td><em>False</em></td>
    </tr>
    <tr>
      <td>PayPal Instant Update</td>
      <td>Allow PayPal to retrieve shipping rates and taxes for the order based on the shipping destination.</td>
      <td><em>True</em></td>
    </tr>
    <tr>
      <td>PayPal Checkout Image</td>
      <td>Use a static or dynamic Express Checkout image button on the shopping cart page.</td>
      <td><em>Static</em></td>
    </tr>
    <tr>
      <td>Page Style</td>
      <td>The page style to use for the Express Checkout flow. This is defined in your PayPal account profile.</td>
      <td></td>
    </tr>
    <tr>
      <td>Transaction Method</td>
      <td>
        The transaction method to use for payment transactions.<br /><br />
        The <em>Authorization</em> method only authorizes the transaction which can be captured up to 29 days later, and must be captured through your PayPal account page.<br /><br />
        The <em>Sale</em> method instantly transfers the funds to your PayPal account.
      </td>
      <td><em>Sale</em></td>
    </tr>
    <tr>
      <td>Set Order Status</td>
      <td>Set the status of orders made with Express Checkout to this order status level.</td>
      <td><em>Default Order Status</em></td>
    </tr>
    <tr>
      <td>PayPal Transactions Order Status</td>
      <td>PayPal transactions are logged in this private order status level.</td>
      <td><em>PayPal [Transactions]</em></td>
    </tr>
    <tr>
      <td>Payment Zone</td>
      <td>If set, this payment method will only be available to orders made within the defined zone.</td>
      <td></td>
    </tr>
    <tr>
      <td>Transaction Server</td>
      <td>
        The transaction server to use for payment transactions.<br /><br />
        The <em>Live</em> server is for production use to receive payments from customers, and the <em>Sandbox</em> server is used to test transactions only.
      </td>
      <td><em>Live</em></td>
    </tr>
    <tr>
      <td>Verify SSL Certificate</td>
      <td>Verify PayPal's identity when API communication calls are sent.</td>
      <td><em>True</em></td>
    </tr>
    <tr>
      <td>Proxy Server</td>
      <td>Send API communication calls through this proxy server.</td>
      <td></td>
    </tr>
    <tr>
      <td>Debug E-Mail Address</td>
      <td>Send invalid transaction parameters to this e-mail address.</td>
      <td></td>
    </tr>
    <tr>
      <td>Sort Order</td>
      <td>The position to show the payment method on the checkout payment page against other available payment methods.</td>
      <td></td>
    </tr>
  </tbody>
</table>

<h2>Add-On Package</h2>

<p>The separate PayPal Express Checkout Add-On package is available at:</p>

<p><a href="http://addons.oscommerce.com/info/5658" target="_blank">http://addons.oscommerce.com/info/5658</a></p>

<h2>Online Demonstration</h2>

<p>An online demonstration is available at:</p>

<p><a href="http://demo.oscommerce.com" target="_blank">http://demo.oscommerce.com</a></p>

<p><i>For the online demonstration, PayPal Express Checkout has been configured with PayPal's Sandbox environment and requires a sandbox account if you wish to log in and not checkout as a guest.</i></p>

<h2>Manual Installation (as an Add-On)</h2>

<p>After extracting the Add-On package, copy the files located in the <em>catalog</em> directory to your osCommerce installation directory on the server. The files must be copied in the correct directory structure as extracted from the Add-On package.</p>

<p>The file listing is as follows:</p>

<ul>
  <li>admin/ext/modules/payment/paypal/paypal_express.php</li>
  <li>ext/modules/payment/paypal/express.php</li>
  <li>ext/modules/payment/paypal/paypal.com.crt</li>
  <li>includes/languages/english/modules/payment/paypal_express.php</li>
  <li>includes/modules/payment/paypal_express.php</li>
</ul>

<p>The standard language definitions in English are provided in the Add-On package. For additional languages, copy the English language definition file to the appropriate language directory and open the file with a text editor to edit the language definitions. The location of the language definition file must be in:</p>

<ul>
  <li>includes/languages/<em>LANGUAGE</em>/modules/payment/paypal_express.php</li>
</ul>

<p>When the files have been copied to their appropriate locations, the payment module will be available on the Administration Tool -> Modules -> Payment Modules -> Install Module page where it can be installed, or on the Administration Tool -> Modules -> Payment Modules page if the module was already previously installed.</p>

<p>If the module was already previously installed, it is important to visit the module configuration page to make sure new parameters are automatically installed in the database.</p>

<h2>Changelog</h2>

<dl class="bulleted">
  <dt>v2.0 xx-May-2014</dt>
  <dd>Use API 112.</dd>
  <dd>If the Set Password account content module is installed, leave the password of the automatically created customer account for guests empty and don't e-mail the customer (requires osCommerce Online Merchant v2.3.4).</dd>
  <dd>Show PayPal logo on the checkout confirmation page as the payment method instead of the module public title.</dd>
  <dd>Allow a PayPal defined Page Style to be used.</dd>
  <dd>Only add line items if line item total calculations matches order total calculations.</dd>
  <dd>Add extra Order Total modules as product line items.</dd>
  <dd>Additionally verify the PayPal transaction before the order is processed.</dd>
  <dd>Allow Instant Update to prevent the customer from proceeding through Express Checkout if no shipping rates are available for the shipping destination (requires osCommerce Online Merchant v2.3.4).</dd>
  <dd>Support Log In with PayPal Seamless Checkout.</dd>
  <dd>Support error code 10486 for when insufficient funds are available in the customers PayPal account.</dd>

  <dt>osCommerce Online Merchant v2.3.3.1 27-Aug-2013</dt>
  <dd>Use API 104.</dd>
  <dd>Label public title with sandbox tag when in sandbox testing mode.</dd>
  <dd>Add Test Connection link in module configuration page.</dd>
  <dd>Verify SSL connections with PayPal public key certificate.</dd>

  <dt>osCommerce Online Merchant v2.3.0 08-Nov-2010</dt>
  <dd>Use API 60.</dd>
  <dd>Allow debug transaction information to be sent in an e-mail for failed transactions.</dd>
  <dd>Pre-Configure the module for new installations with the store configured store owner e-mail address.</dd>
  <dd>Add support for PayPal Account Optional.</dd>
  <dd>Introduce Instant Update to have PayPal retrieve shipping rates and taxes based on the shipping destination.</dd>
  <dd>Include PayPal transaction information in a private order status level.</dd>
  <dd>Automatically create customer accounts for guests when returning back to the store from the Express Checkout flow. Accounts are created with an automatically generated random password that is e-mailed to the customer.</dd>

  <dt>v1.0 11-Jan-2008</dt>
  <dd>Initial Release</dd>
</dl>
