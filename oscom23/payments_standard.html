<h1>Payments Standard <small>v3.0<br />for osCommerce Online Merchant v2.3</small></h1>

<p>PayPal Payments Standard is bundled with osCommerce Online Merchant and is also available as a separate Add-On package existing store owners can use to upgrade to.</p>

<p>The PayPal Payments Standard payment module supports the following PayPal features:</p>

<ul>
  <li>Encrypted Website Payments</li>
  <li>Instant Payment Notification</li>
  <li>Authorization and Sale transaction methods</li>
  <li>SSL Certificate verified transactions</li>
  <li>Sandbox server to perform test transactions</li>
</ul>

<div class="visible-print">
  <p>This document can be found online at:</p>

  <p><a href="{link}Package|Library|en&paypal&oscom23&payments_standard{link}">{link}Package|Library|en&paypal&oscom23&payments_standard{link}</a></p>
</div>

<h2>Features</h2>

<h3>Encrypted Website Payments</h3>

<p>Encrypted Website Payments allows the initial transaction information to be encrypted using public and private keys before it is sent to PayPal. This protects the order information from being tampered with and securely initiates the transaction with PayPal.</p>

<p>Please refer to Configuring Settings -> Encrypted Website Payments in this document for more information.</p>

<h4 class="notoc">Requirements</h4>

<p>Encrypted Website Payments requires the following:</p>

<ul>
  <li>OpenSSL; The PHP installation on your web server needs to support OpenSSL or have access to the "openssl" program file. The location of the "openssl" program file can be defined in a configuration parameter.</li>
</ul>

<h3>Instant Payment Notification</h3>

<p>All orders processed through PayPal Payments Standard are verified by a separate call PayPal automatically performs when an order has been processed. PayPal sends an Instant Payment Notification (IPN) to your store with the order information which is then verified and logged with the order.</p>

<p>The results of the verification are logged in a private order status that can be seen when viewing the order.</p>

<h3>SSL Certificate Verified Transactions</h3>

<p>All secured API transaction calls sent to PayPal are performed by verifying PayPal's SSL certificates to guarantee the identity of PayPal. This is performed by using the following public keys in order if they are available:</p>

<ul>
  <li>ext/modules/payment/paypal/paypal.com.crt</li>
  <li>includes/cacert.pem (public key bundle)</li>
  <li>the web server configured public key bundle</li>
</ul>

<p>A test connection link is available on the payment module configuration page which can be used to test if API transaction calls to PayPal can be verified from your web server. If the test connection fails, please contact your hosting provider as they may need to update your web server configuration. The SSL certificate verification can also be disabled on the payment module configuration page however it is highly discouraged to disable.</p>

<div class="alert">Some web hosting providers require a curl proxy to be used which can be configured on the payment module configuration page.</div>

<h2>Configuration Settings</h2>

<table class="table table-striped table-hover">
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Enable PayPal Payments Standard</td>
      <td>Setting this parameter to <em>True</em> makes the payment method available to customers during the checkout procedure.</td>
      <td><em>True</em></td>
    </tr>
    <tr>
      <td>Seller E-Mail Address</td>
      <td>The PayPal seller account e-mail address to accept payments for.</td>
      <td></td>
    </tr>
    <tr>
      <td>Primary E-Mail Address</td>
      <td>The primary PayPal seller account e-mail address for when multiple PayPal e-mail addresses have been setup with the account. This is used to verify the IPN with and can be left empty.</td>
      <td></td>
    </tr>
    <tr>
      <td>Page Style</td>
      <td>The page style to use for the payment flow. This is defined in your PayPal account profile.</td>
      <td></td>
    </tr>
    <tr>
      <td>Transaction Method</td>
      <td>
        The transaction method to use for payment transactions.<br /><br />
        The <em>Authorization</em> method only authorizes the transaction which can be captured up to 29 days later, and must be captured through your PayPal account page.<br /><br />
        The <em>Sale</em> method instantly transfers the funds to your PayPal account.
      </td>
      <td><em>Sale</em></td>
    </tr>
    <tr>
      <td>Set Preparing Order Status</td>
      <td>
        The customers order is saved in the database on the checkout confirmation page before the customer is forwarded to PayPal to finalize the payment transaction. The order is saved in the database with this defined order status.<br /><br />
        The order status is updated again when the customer finalizes the payment transaction at PayPal and returns to the store with the link provided by PayPal. The order status is also updated when the Instant Payment Notification from PayPal is received.<br /><br />
        If the customer does not finalize the payment transaction at PayPal, the order remains in the database with this order status and can be removed after a period of time.
      </td>
      <td><em>Preparing [PayPal Standard]</em></td>
    </tr>
    <tr>
      <td>Set PayPal Acknowledged Order Status</td>
      <td>The orders status will be updated to this value when the customer returns back to the store after payment has been made at PayPal or when the Instant Payment Notification is received and the order has been verified.</td>
      <td><em>Default Order Status</em></td>
    </tr>
    <tr>
      <td>PayPal Transactions Order Status</td>
      <td>PayPal transactions are logged in this private order status level.</td>
      <td><em>PayPal [Transactions]</em></td>
    </tr>
    <tr>
      <td>Payment Zone</td>
      <td>If set, this payment method will only be available to orders made within the defined zone.</td>
      <td></td>
    </tr>
    <tr>
      <td>Gateway Server</td>
      <td>
        The gateway server to use for payment transactions.<br /><br />
        The <em>Live</em> server is for production use to receive payments from customers, and the <em>Sandbox</em> server is used to test transactions only.
      </td>
      <td><em>Live</em></td>
    </tr>
    <tr>
      <td>Verify SSL Certificate</td>
      <td>Verify PayPal's identity when API communication calls are sent.</td>
      <td><em>True</em></td>
    </tr>
    <tr>
      <td>Proxy Server</td>
      <td>Send API communication calls through this proxy server.</td>
      <td></td>
    </tr>
    <tr>
      <td>Debug E-Mail Address</td>
      <td>Send invalid transaction parameters to this e-mail address.</td>
      <td></td>
    </tr>
    <tr>
      <td>Enable Encrypted Website Payments</td>
      <td>Setting this parameter to True encrypts the parameters sent to PayPal during the payment transaction.</td>
      <td><em>False</em></td>
    </tr>
    <tr>
      <td>Your Private Key</td>
      <td>The location and filename of your private key to use for signing the payment transaction.</td>
      <td></td>
    </tr>
    <tr>
      <td>Your Public Certificate</td>
      <td>The location and filename of your public certificate to use for signing the payment transaction.</td>
      <td></td>
    </tr>
    <tr>
      <td>PayPals Public Certificate</td>
      <td>The location and filename of the PayPal public certificate to use for encrypting the payment transaction.</td>
      <td></td>
    </tr>
    <tr>
      <td>Your PayPal Public Certificate ID</td>
      <td>The public certificate ID that PayPal should use to decrypt the payment transaction. This is defined at your PayPal Encrypted Payment Settings Profile page.</td>
      <td></td>
    </tr>
    <tr>
      <td>Working Directory</td>
      <td>The working directory to create temporary files. All files created are automatically deleted when they are no longer needed.</td>
      <td></td>
    </tr>
    <tr>
      <td>OpenSSL Location</td>
      <td>The location and filename of the OpenSSL "openssl" program file used when PHP has not been configured with OpenSSL natively.</td>
      <td><em>/usr/bin/openssl</em></td>
    </tr>
    <tr>
      <td>Sort Order</td>
      <td>The position to show the payment method on the checkout payment page against other available payment methods.</td>
      <td></td>
    </tr>
  </tbody>
</table>

<h3>Encrypted Website Payments</h3>

<p>The following steps are required before Encrypted Website Payments is enabled:</p>

<ol>
  <li>Generate your private key.</li>
  <li>Generate your public certificate.</li>
  <li>Upload your public certificate to your PayPal account.</li>
  <li>Download the PayPal public certificate from the PayPal website.</li>
  <li>Update module configuration parameters.</li>
</ol>

<p>and optionally:</p>

<ol start="6">
  <li>Block non-encrypted website payments.</li>
</ol>

<p>Private keys and public certificates can be generated by using the "openssl" program file.</p>

<h4 class="notoc">1. Generate your private key</h4>

<p>Enter the following OpenSSL command to generate your private key. The command generates a 1024-bit RSA private key that is stored in the file my-prvkey.pem:</p>

{code}openssl genrsa -out my-prvkey.pem 1024{code}

<h4 class="notoc">2. Generate your public certificate</h4>

<p>Your public certificate must be in PEM format. To generate your certificate, enter the following OpenSSL command, which generates a public certificate in the file my-pubcert.pem:</p>

{code}openssl req -new -key my-prvkey.pem -x509 -days 365 -out my-pubcert.pem{code}

<p>The following questions will be prompted:</p>

<table class="table table-striped table-hover">
  <thead>
    <tr>
      <th>Question</th>
      <th>Example</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Country Name (2 letter code)</td>
      <td>US</td>
    </tr>
    <tr>
      <td>State or Province Name (full name)</td>
      <td>California</td>
    </tr>
    <tr>
      <td>Locality Name (eg, city)</td>
      <td>Beverly Hills</td>
    </tr>
    <tr>
      <td>Organization Name (eg, company)</td>
      <td>Your Store Name</td>
    </tr>
    <tr>
      <td>Organizational Unit Name (eg, section)</td>
      <td></td>
    </tr>
    <tr>
      <td>Common Name (e.g. server FQDN or YOUR name)</td>
      <td>Your Store URL Address</td>
    </tr>
    <tr>
      <td>Email Address</td>
      <td>Your E-Mail Address</td>
    </tr>
  </tbody>
</table>

<h4 class="notoc">3. Upload your public certificate to your PayPal account</h4>

<p>To upload your public certificate to your PayPal account:</p>

<ol>
  <li>Log in to your PayPal Business or Premier account.</li>
  <li>Click the Profile subtab.</li>
  <li>In the Hosted Payment Settings column, click the Website Payment Certificates link.</li>
  <li>Scroll down the page to the Your Public Certificates section, and click the Add button.</li>
  <li>Click the Browse button, and select the public certificate that you want to upload to PayPal (<em>my-pubcert.pem</em>).</li>
  <li>Click the Add button.</li>
</ol>

<p>After your public certificate uploads successfully, it appears in the Your Public Certificates section of the Website Payment Certificates page.</p>

{image}ps_pp_pubcert.png{image}

<ol start="7">
  <li>Note the certificate ID that PayPal assigned to your public certificate.</li>
</ol>

<h4 class="notoc">4. Download the PayPal public certificate from the PayPal website</h4>

<p>To download the PayPal public certificate:</p>

<ol>
  <li>Log in to your PayPal Business or Premier account.</li>
  <li>Click the Profile subtab.</li>
  <li>In the Hosted Payment Settings column, click the Website Payment Certificates link.</li>
  <li>Scroll down the page to the PayPal Public Certificate section.</li>
</ol>

{image}ps_pp_download_pp_cert.png{image}

<ol start="5">
  <li>Click the Download button, and save the file in a secure location.</li>
</ol>

<h4 class="notoc">5. Update module configuration parameters.</h4>

<p>Copy the following files to a secure location your web server:</p>

<ul>
  <li>my-prvkey.pem; <em>Your private key generated in step 1.</em></li>
  <li>my-pubcert.pem; <em>Your public certificate generated in step 2.</em></li>
  <li>paypal_cert_pem.txt; <em>The PayPal public certificate downloaded in step 4.</em></li>
</ul>

<p>Create a working directory on the web server that the web server has write access to.</p>

<p>Review and update the module Encrypted Website Payments parameters:</p>

<table class="table table-striped table-hover">
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Enable Encrypted Website Payments</td>
      <td>Set to <em>True</em> to enable Encrypted Website Payments.</td>
    </tr>
    <tr>
      <td>Your Private Key</td>
      <td>The location and filename of your private key; my-prvkey.pem generated in Step 1.</td>
    </tr>
    <tr>
      <td>Your Public Certificate</td>
      <td>The location and filename of your public certificate; my-pubcert.pem generated in Step 2.</td>
    </tr>
    <tr>
      <td>PayPals Public Certificate</td>
      <td>The location and filename of the PayPal public certificate; paypal_cert_pem.txt downloaded in Step 4.</td>
    </tr>
    <tr>
      <td>Your PayPal Public Certificate ID</td>
      <td>Your PayPal stored Certificate ID; noted in Step 3.</td>
      <td></td>
    </tr>
    <tr>
      <td>Working Directory</td>
      <td>The working directory to create temporary files. All files created are automatically deleted when they are no longer needed.</td>
    </tr>
    <tr>
      <td>OpenSSL Location</td>
      <td>The location and filename of the OpenSSL "openssl" program file used when PHP has not been configured with OpenSSL natively.</td>
    </tr>
  </tbody>
</table>

<h4 class="notoc">6. Block non-encrypted website payments.</h4>

<p>Optionally, orders processed through non-encrypted website payments can be blocked for extra security. This is recommended only if Encrypted Website Payments has been enabled.</p>

<p>To block payments from unprotected and non-encrypted PayPal Payments Standard orders:</p>

<ol>
  <li>Log in to your PayPal Premier account or Business account.</li>
  <li>Click the Profile subtab.</li>
  <li>In the Hosted Payment Settings column, click the Website Payments Preferences link.</li>
  <li>Scroll down to the Encrypted Website Payments section.</li>
</ol>

{image}ps_pp_block_non_ewp.png{image}

<ol start="5">
  <li>Next to the Block Non-encrypted Website Payment label, select the On radio button.</li>
  <li>Scroll to the bottom of the page, and click the Save button.</li>
</ol>

<h2>Notes</h2>

<h3>Order Processing</h3>

<p>When the customer goes through the checkout procedure and lands on the checkout confirmation page, their order is saved in the database with a private order status (by default, <em>Preparing [PayPal Standard]</em>). The order status is updated to an acknowledged order status (by default, the default order status level) when the customer returns back to the store from PayPal after payment has been made, or when the IPN notification is received if the customer didn't return back to the store.</p>

<p>If the customer did not finalize the payment at PayPal and does not return back to the store, the order remains in the database with the <em>Preparing [PayPal Standard]</em> order status and can be safely deleted after a period of time.</p>

<h2>Add-On Package</h2>

<p>The separate PayPal Payments Standard Add-On package is available at:</p>

<p><a href="http://addons.oscommerce.com/info/5655" target="_blank">http://addons.oscommerce.com/info/5655</a></p>

<h2>Online Demonstration</h2>

<p>An online demonstration is available at:</p>

<p><a href="http://demo.oscommerce.com" target="_blank">http://demo.oscommerce.com</a></p>

<p><i>For the online demonstration, PayPal Payments Standard has been configured with PayPal's Sandbox environment and requires a sandbox account if you wish to log in and not checkout as a guest.</i></p>

<h2>Manual Installation (as an Add-On)</h2>

<p>After extracting the add-on package, copy the files located in the <em>catalog</em> directory to your osCommerce installation directory on the server. The files must be copied in the correct directory structure as extracted from the add-on package.</p>

<p>The file listing is as follows:</p>

<ul>
  <li>ext/modules/payment/paypal/paypal.com.crt</li>
  <li>ext/modules/payment/paypal/standard_ipn.php</li>
  <li>includes/languages/english/modules/payment/paypal_standard.php</li>
  <li>includes/modules/payment/paypal_standard.php</li>
</ul>

<p>The standard language definitions in English are provided in the Add-On package. For additional languages, copy the English language definition file to the appropriate language directory and open the file with a text editor to edit the language definitions. The location of the language definition file must be in:</p>

<ul>
  <li>includes/languages/<em>LANGUAGE</em>/modules/payment/paypal_standard.php</li>
</ul>

<p>When the files have been copied to their appropriate locations, the payment module will be available on the Administration Tool -> Modules -> Payment -> Install Module page where it can be installed, or on the Administration Tool -> Modules -> Payment page if the module was already previously installed.</p>

<p>If the module was already previously installed, it is important to visit the module configuration page to make sure new parameters are automatically installed in the database.</p>

<h2>Changelog</h2>

<dl class="bulleted">
  <dt>v3.0 27-May-2014</dt>
  <dd>Show PayPal logo on the checkout confirmation page as the payment method instead of the module public title.</dd>
  <dd>Include PayPal transaction information in a private order status level.</dd>

  <dt>v2.0 22-Aug-2013</dt>
  <dd>Label public title with sandbox tag when in sandbox testing mode.</dd>
  <dd>Add Test Connection link in module configuration page.</dd>
  <dd>Add additional checks when processing the order.</dd>

  <dt>v1.1 28-May-2013</dt>
  <dd>Additionally verify the PayPal transaction before the order is processed.</dd>
  <dd>Add Primary Seller E-Mail Address parameter for cases when it is different to the Seller E-Mail Address.</dd>
  <dd>Verify SSL connections with PayPal public key certificate.</dd>

  <dt>v1.0 11-Jan-2008</dt>
  <dd>Initial Release</dd>
</dl>
